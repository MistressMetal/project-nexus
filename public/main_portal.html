<!--Header-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEIU HCPA Member Portal</title>

    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#FFED00" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Project Nexus" />
    <link rel="apple-touch-icon" href="/icons/small.png" />
    <link rel="icon" type="image/x-icon" href="/icons/tiny.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
<body>
    <div class="topnav" id="myTopnav">
        <a href="#home" class="active">Home</a>
        <a href="#announcement-section">Announcements</a>
        <a href="#myinformation-section">My Information</a>
        <a href="#chapterinformation-section">Chapter Information</a>
        <a href="index.html" onclick="signOut()">Sign Out</a>
        <a href="#MRC-section">Member Resource Center</a>
        <a href="javascript:void(0);" class="icon" onclick="navMenu()">
          <i class="fa fa-bars"></i>
        </a>
      </div>


    <div class="main-body">
        <h1 id="portal-name"></h1>

        <!-- Permission Popup -->
        <div class="permission-overlay" id="permissionOverlay" style="display: none;">
          <div class="permission-popup">
              <h2>Enable Notifications</h2>
              <p>We'd like to send you updates and personalized messages. You can change this anytime in settings.</p>
              <div class="permission-buttons">
                  <button class="btn btn-allow" id="requestToken">Allow</button>
                  <button class="btn btn-deny" id="denyToken">Not Now</button>
              </div>
          </div>
        </div>    
        
        <!--ANNOUNCEMENTS-->
        <section id="announcement-section">
          <h2>Announcements</h2>
          <div class="table-container">
            <table id="announcementsTable">
              <thead>
                <tr>
                    <th class="col-announce-date">Created At</th>
                    <th class="col-announce-type">Type</th>
                    <th class="col-announce-posted">Posted By</th>
                    <th class="col-announce-text">Announcement</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                  <tr><td colspan="4">Loading...</td></tr>
              </tbody>
          </table>  
        </div>
        </section>


    <section id="myinformation-section">
      <h2>My Information</h2>
      <p>This will eventually connect to Zoho.
        The trick would be getting the match correct - based on emails? 
        If a person isn't matched, could there be a button to a link or form to somehow request to be matched?
        <ul>
          <li>Name</li>
          <li>Address</li>
          <li>Phone</li>
          <li>Job Title</li>
          <li>Dues / COPE information</li>
          <li>Card</li>
        </ul>
      </section>

      <section id="chapterinformation-section">
        <h2>Chapter Information</h2>
        <p>Information about your chapter, including contact info for leadership, and facebook page</p>
      </section>

    <section id="MRC-section">
      <h2>Member Resource Center</h2>
      <p>The <a href="https://seiuhcpa.org/resources/help/">Member Resource Center</a> is available to help in solving workplace issues.</p>
      <p><strong>In Pennsylvania:</strong> 1-800-252-3894</p>
      <p><strong>Out of state:</strong> 412-222-9514</p>
    </section>
  </div>

</body>
<script src="/app.js" type="module"></script>

<script type="module">
async function initializePage() {
  try {
    const login_data = await getLogin();
    const role = login_data.role;
    
    if (!['admin','member','superuser', 'organizer'].includes(role)) {
      window.location.replace("status_pending.html");
      return;
    }
    const portal_name = document.getElementById("portal-name");
    portal_name.textContent = `${login_data.chapter} Member Portal`;

    if (['admin','organizer','superuser'].includes(role)) {
      const nav = document.getElementById("myTopnav");
      nav.innerHTML = `
        <a href="#home" class="active">Home</a>
        <a href="#announcement-section">Announcements</a>
        <a href="#myinformation-section">My Info</a>
        <a href="#chapterinformation-section">Chapter</a>
        <a href="#MRC-section">MRC</a>
        <a href="index.html" onclick="signOut()">Sign Out</a>
        <a href="admin_portal.html">Admin</a>
        <a href="javascript:void(0);" class="icon" onclick="navMenu()">
          <i class="fa fa-bars"></i>
        </a>`;
      }

      await loadAnnouncements();
      
      // Check notification permission and show popup if needed
      checkNotificationPermission();
      
  } catch (error) {
    console.error('Error initializing page: ', error);
    window.location.replace("index.html");
  }
}

function checkNotificationPermission() {
    const permissionStatus = localStorage.getItem('messagingPermission');
    
    if (!permissionStatus) {
        document.getElementById('permissionOverlay').style.display = 'flex';
    }
}

initializePage();
</script>
</html>