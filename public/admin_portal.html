<!--Header-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEIU HCPA Admin Portal</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#FFED00" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Project Nexus" />
    <link rel="apple-touch-icon" href="/icons/small.png" />
    <link rel="icon" type="image/x-icon" href="/icons/tiny.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="topnav" id="myTopnav">
        <a href="#home" class="active">Home</a>
        <a href="#announcement-section">Announcements</a>
        <a href="#myinformation-section">My Information</a>
        <a href="#chapterinformation-section">Chapter Information</a>
        <a href="#MRC-section">Member Resource Center</a>
        <a href="javascript:void(0);" class="icon" onclick="navMenu()">
          <i class="fa fa-bars"></i>
        </a>
      </div>
    <div class="main-body">
        <h1 id="portal-name"></h1>
        <!--if signed in a approved-->
    <div id="announcement-section">
      <h2>Announcements</h2>
      <table id="announcementsTable">
          <thead>
              <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Posted By</th>
                  <th>Announcement</th>
              </tr>
          </thead>
          <tbody id="tableBody">
              <tr><td colspan="5">Loading...</td></tr>
          </tbody>
      </table>  
    </div>

    <div id="users-section">
      <h1>Manage Users</h1>
      <table id="userTable">
          <thead>
              <tr>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Email</th>
                  <th>Chapter</th>
                  <th>Role</th>
                  <th>Active</th>
                  <th>Approve</th>
                  <th>Make Admin</th>
                  <th>Active?</th>
              </tr>
          </thead>
          <tbody id="userTableBody">
              <tr><td colspan="5">Loading...</td></tr>
          </tbody>
      </table>
      </div>

</div>


</body>
<script>
</script>
<script src="/app.js" type="module">   </script>
<script type="module">

//get logged in status

const login_data = await getLogin();
const role = login_data.role;
console.log('first')
console.log(role)
if (role === 'member'){
  window.location.replace("main_portal.html")
}
else if (role !== 'admin' && role !== 'superuser' && role !== 'organizer') {
  window.location.replace("status_pending.html");}
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
  console.log(role);
  console.log(x);
  if (role === 'admin' || role === 'organizer' || role === 'superuser') {
    x.innerHTML = `
  <a href="#home" class="active">Home</a>
        <a href="#announcement-section">Announcements</a>
        <a href="#myinformation-section">My Information</a>
        <a href="#chapterinformation-section">Chapter Information</a>
        <a href="#MRC-section">Member Resource Center</a>
        <a href="admin.html">Admin Portal</a>
        <a href="javascript:void(0);" class="icon" onclick="navMenu()">
          <i class="fa fa-bars"></i>
        </a>`
}

document.getElementById('userTableBody').addEventListener('click', async (e) => {
    if (e.target.classList.contains('btn-approve')) {
        const id = e.target.dataset.id;
        const row_id = e.target.dataset.rowId;
        await approveUser(id, row_id, e.target);
    }

    if (e.target.classList.contains('btn-active')) {
        const id = e.target.dataset.id;
        console.log(id)
        const active = e.target.dataset.active;
        console.log(active)
        const row_id = e.target.dataset.row_id;
        await changeActive(id, active, row_id, e.target);
    }

    if (e.target.classList.contains('btn-admin')) {
      const is = e.target.dataset.id;
      const role = e.target.dataset.role;
      const row_id = e.target.dataset.row_id;
      await changeAdmin(id, role, row_id, e.target);
    }

})

editUsers();

editAnnouncements();

</script>